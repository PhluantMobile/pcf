pcf={adInit:null,winLoaded:false,adIsExpanded:false,closeCallback:null,geocoder:null,iosVersion:null,isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()}},isMraid:false,isPhad:false,phadConsoleLog:false,videoPlaying:false,video_properties:{aspect_ratio:"16:9",attributes:{"webkit-playsinline":false,controls:true,autoplay:true},container_id:null,close_callback:null,full_screen:false,hide_close_btn:true,pause_callback:null,play_callback:null,reload:false,style:{width:"320px",height:"180px",zIndex:5e3,margin:0,padding:0}},videoReload:false,hashtag:null,executionID:null,campaignID:null,sessionID:null,container:null,webServiceUrl:"http://lbs.phluant.com/web_services/",ajax:function(e){console.log(e);ajaxRequest=new XMLHttpRequest;var t="";console.log(typeof e.data);if(typeof e.data!="undefined"){for(var n in e.data){if(t!=""){t+="&"}t+=n+"="+encodeURIComponent(e.data[n])}}console.log(t);if(e.method!="POST"&&t!=""){e.url+="?"+t}var r=1e4;if(typeof e.timeout=="number"){r=e.timeout}console.log(e.url);ajaxRequest.open(e.method,e.url,true);if(e.method=="POST"){ajaxRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");ajaxRequest.send(t)}else{ajaxRequest.send()}var i=setTimeout(function(){ajaxRequest.abort();if(typeof e.callback!="undefined"){e.callback({status:"timeout"})}},r);ajaxRequest.onreadystatechange=function(){clearTimeout(i);if(ajaxRequest.readyState==4&&ajaxRequest.status==200){if(typeof e.js_object!="undefined"){var t=ajaxRequest.responseText;if(e.js_object){t=JSON.parse(t)}}if(typeof e.callback!="undefined"){e.callback(t)}}else{if(typeof e.callback!="undefined"){e.callback({status:"error",request_info:ajaxRequest})}}}},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},clickthru:function(e){if(this.isPhad){if(this.phadConsoleLog){ph.u.log(e.name)}ph.u.clickthru(e.url,e.name,this.sessionID)}else{console.log(e.name);window.open(e.url,"_blank")}},contract:function(){if(this.videoPlaying){this.video_close()}if(this.isMraid){mraid.close()}if(this.isPhad){ph.t.close("MainPanel",this.sessionID);if(this.phadConsoleLog){ph.u.log("contracting")}}else{console.log("contracting")}if(typeof this.closeCallback=="function"){this.closeCallback()}},expand:function(e){var t="expanding to "+e.width+"px width, "+e.height+"px height.";if(this.isPhad){ph.t.expand("MainPanel",this.sessionID,false,{width:e.width,height:e.height});if(this.phadConsoleLog){ph.u.log(t)}}else{console.log(t)}if(this.isMraid){this.adIsExpanded=true}},image_tracker:function(e){if(this.isPhad){ph.u.addImage(e)}else{var t=document.createElement("img");t.src=e;document.getElementsByTagName("body")[0].appendChild(t)}},geolocation:function(e){console.log(e);var t={url:this.webServiceUrl+"geolocation/export",method:"GET",callback:e.callback,js_object:true};if(typeof e.data!="undefined"){t.data=e.data}this.ajax(t)},geolocation_prompt:function(e){var t=this;navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude};e.callback(n)},function(n){if(e.failover){t.geolocation(e)}else{e.callback(false)}})},get_stores:function(e){console.log(e);var t={url:this.webServiceUrl+"phluant/export",method:"GET",callback:e.callback,js_object:true,data:{limit:3,dist:30}};if(typeof e.data.campaign_id=="undefined"){console.log("campaign_id is a required attribute for this function");return false}for(var n in e.data){t.data[n]=e.data[n]}t.data.type="get_stores";this.ajax(t)},gid:function(e){return document.getElementById(e)},gmaps_draw:function(e){var t=10;if(typeof e.map_zoom!="undefined"){t=e.map_zoom}var n={zoom:t,center:new google.maps.LatLng(e.center_lat,e.center_lng),disableDefaultUI:true,mapTypeId:google.maps.MapTypeId.ROADMAP};if(typeof e.map_id=="undefined"){console.log("A map id must be specified");return false}else{if(typeof e.map_id=="string"){e.map_id=this.gid(e.map_id)}}var r=new google.maps.Map(e.map_id,n);if(typeof e.markers!="undefined"){for(var i in e.markers){var s=e.markers[i];var o=new google.maps.LatLng(s.lat,s.lng);var u={position:o,map:r};var a=["lat","lng","clickthru"];for(var f in s){if(a.indexOf(s[f])==-1){u[f]=s[f]}}var l=new google.maps.Marker(u);if(typeof s.clickthru!="undefined"){l.clickthru=s.clickthru;google.maps.event.addListener(l,"click",function(){var t="http://maps.google.com/?saddr="+e.user_lat+","+e.user_lng+"&daddr="+this.position.k+","+this.position.A;if(typeof this.clickthru.url!="undefined"){t=this.clickthru.url}if(pcf.isPhad){if(pcf.phadConsoleLog){ph.u.log(this.clickthru.name)}ph.u.clickthru(t,this.clickthru.name,pcf.sessionID)}else{console.log(this.clickthru.name);window.open(t,"_blank")}})}}}},gmaps_geo:function(e){console.log(e);var t="address";if(typeof e.loc_type!="undefined"){t=e.loc_type}if(this.geocoder==null){this.geocoder=new google.maps.Geocoder}var n=this;if(t=="geo"||"latLng"){console.log(e.address);if(this.valid_geo(e.address)){var r=e.address.split(",");var i=new google.maps.LatLng(r[0],r[1]);this.geocoder.geocode({latLng:i},function(t,r){n.gmaps_return(t,r,e)})}else{console.log("Must be a valid lat/lng set for reverse geocoding");return false}}else{console.log(e.address);this.geocoder.geocode({address:encodeURIComponent(e.address)},function(t,r){console.log(t);console.log(r);n.gmaps_return(t,r,e)})}},gmaps_return:function(e,t,n){if(t==google.maps.GeocoderStatus.OK){n.callback(e)}else{if(typeof n.failover=="boolean"){if(n.failover){var r={};r.callback=n.callback;if(typeof n.failover_callback!="undefined"){r.callback=n.failover_callback}if(this.valid_zip(address)){r.data.type="postal_code"}if(this.valid_geo(address)){r.data.type="city_postal_by_geo"}if(typeof r.data.type!="undefined"){r.data.value=n.address}this.geolocation(r)}}else{n.callback(false)}}},init:function(e){var t=this;if(typeof e.callback=="function"){this.closeCallback=e.callback}if(typeof e.init=="function"){this.adInit=e.init}if(typeof e.expanded!="undefined"){if(e.expanded){t.adIsExpanded=true}}if(typeof mraid!="undefined"){this.isMraid=true;mraid.setExpandProperties({useCustomClose:true});mraid.addEventListener("stateChange",function(){if(t.adIsExpanded){if(typeof t.closeCallback!="null"){t.closeCallback()}t.adIsExpanded=false}});document.body.style.margin="0px";this.container.style.position="absolute";var n=document.createElement("meta");n.name="viewport";n.content="width=device-width, minimum-scale=1.0, maximum-scale=1.0";document.getElementsByTagName("head")[0].appendChild(n)}if(this.adInit!=null){if(this.isMraid){if(mraid.getState()==="loading")mraid.addEventListener("ready",t.mraid_ready);else this.mraid_ready()}else this.adInit()}},iosVersionCheck:function(){var e=window.navigator.userAgent,t=e.indexOf("OS ");if((e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1){return window.Number(e.substr(t+3,3).replace("_","."))}return 0},mraid_ready:function(){if(mraid.isViewable())this.mraid_view_change();else mraid.addEventListener("viewableChange",this.mraid_view_change)},mraid_view_change:function(){if(mraid.isViewable()){if(!this.winLoaded){winLoaded=true;window.dispatchEvent(new Event("load"))}this.track("viewableChange");setTimeout(this.adInit.bind(this))}},query_string:function(e){var t=window.location.href;if(t.indexOf("?")!=-1){var n=new Object;var r=t.split("?");var i=r[1].split("&");for(var s=0;s<i.length;s++){var o=i[s].split("=");n[o[0]]=decodeURIComponent(o[1])}if(e){n=JSON.stringify(n)}return n}else{return false}},session_import:function(e){for(var t in e){this[t]=e[t]}},shoplocal:function(e){var t={url:this.webServiceUrl+"phluant/export",method:"GET",callback:e.callback,js_object:true,data:{call_type:"store"}};for(var n in e.data){t.data[n]=e.data[n]}var r=["company","campaignid"];for(var n=0;n<r.length;n++){if(typeof t.data[r[n]]=="undefined"){console.log(r[n]+" is a required attribute for the shoplocal function.");return false}}if(t.data.subtype=="postal_code"&&!this.valid_zip(t.data.value)){console.log("invalid postal code format :".varsExport.data.value);return false}if(t.data.call_type.indexOf("retailertag")!=-1&&typeof t.data.retailertagids=="undefined"){console.log("category_tree_id must be defined for a shoplocal category lookup.");return false}t.data.type="shoplocal";this.ajax(t)},track:function(e){if(this.isPhad){ph.u.track("interaction","cint="+e,this.sessionID);if(this.phadConsoleLog){ph.u.log(e)}}else{console.log(e)}},valid_email:function(e){var t=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e)},valid_geo:function(e){passed=true;console.log(e);e=e.split(",");if(typeof e=="object"){for(var t=0;t<e.length;t++){if(isNaN(e[t])){passed=false;break}}}else{passed=false}return passed},valid_phone:function(e){if(e){e=e.replace(/[^0-9]/g,"");return/^\d{10}/.test(zipTest)}},valid_zip:function(e){return/^\d{5}(-\d{4})?$/.test(e)},video:function(e){var t=this;this.videoPlaying=true;objCheck=["style","attributes"];if(!this.videoReload){for(var n in e){if(objCheck.indexOf(n)!=-1){for(var r in e[n]){this.video_properties[n][r]=e[n][r]}}else{this.video_properties[n]=e[n]}}}if(this.video_properties.full_screen){this.video_properties.attributes["webkit-playsinline"]=false}var i=this.video_properties.container_id;this.video_properties.style.width=i.offsetWidth+"px";this.video_properties.style.height=i.offsetHeight+"px";var s=this.video_properties.aspect_ratio.split(":");if(this.video_properties.style.width=="0px"&&this.video_properties.style.height=="0px"){console.log("at least a height or a width for the video element or its parent element must be declared");return false}if(this.video_properties.style.width!="0px"&&this.video_properties.style.height=="0px"){this.video_properties.style.height=this.video_properties.style.width.replace("px","")*(s[1]/s[0])+"px"}if(this.video_properties.style.width=="0px"&&this.video_properties.style.height!="0px"){this.video_properties.style.width=this.video_properties.style.height.replace("px","")*(s[0]/[1])+"px"}if(this.isPhad){ph.v.play(this.video_properties.video_url,this.video_properties.name,this.campaignID,this.executionID,this.sessionID,i);if(this.video_properties.hide_close_btn){var o=this.gid("phVidClose");if(o){o.style.display="none"}}}else{var u='<video src="'+this.video_properties.video_url+'"></video>';i.innerHTML=u}var a=i.getElementsByTagName("video")[0];if(a){for(var n in this.video_properties.attributes){a.setAttribute(n,this.video_properties.attributes[n])}for(var n in this.video_properties.style){a.style[n]=this.video_properties.style[n]}a.addEventListener("play",function(){if(t.video_properties.full_screen){t.video_full_screen(a)}if(typeof t.video_properties.play_callback=="function"){t.video_properties.play_callback()}});a.addEventListener("pause",function(){if(typeof t.video_properties.pause_callback=="function"){t.video_properties.pause_callback()}});if(this.video_properties.attributes.autoplay===true){setTimeout(function(){a.play()},500)}if(!this.video_properties.full_screen){a.addEventListener("webkitendfullscreen",function(){t.video_close()})}a.addEventListener("ended",function(){t.video_close()})}},video_close:function(){if(this.isPhad){ph.v.remove()}else{this.video_properties.container_id.innerHTML=""}this.videoPlaying=false;if(typeof this.video_properties.close_callback=="function"){this.video_properties.close_callback()}if(this.video_properties.reload){this.videoReload=true;this.video_properties.attributes.autoplay=false;this.video()}},video_full_screen:function(e){var t=this;var n="endfullscreen";if(e.requestFullscreen){e.requestFullscreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen();n="mozendfullscreen"}else if(e.webkitRequestFullscreen){e.webkitRequestFullscreen();n="webkitendfullscreen"}else if(e.msRequestFullscreen){e.msRequestFullscreen();n="msendfullscreen"}e.addEventListener(n,function(){t.video_close()})}};pcf.iosVersion=pcf.iosVersionCheck();if(typeof ph=="object"){pcf.isPhad=true}window.addEventListener("load",function(){pcf.winLoaded=true})